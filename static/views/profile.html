<div ng-include src="'views/navbar.html'"></div>
<div class="container" id="profile" ng-controller="ConversationsController" ng-init="get_conversations(); set_page();">
    <div class="row" id="profile_row">
        <div id="other_users_wrapper" class="col-xs-12 col-sm-12 col-md-6">
            <div class="row" id="all_other_users">
                <h3 id="other_users_header">Users</h3>
                <ul id="other_users">
                    <li ng-repeat="user in paged_users" ng-click="open('md', user)">
                        <div class="well">
                            <img preload-image ng-src="{{ user.avatar_url  }}" class="img-responsive">
                            <div class="user_title">
                                <h4>{{user.first_name}} {{user.last_name}}</h4>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="page_wrapper">
                <div class="page_inner">
                    <pagination class="pagination" max-size="5" boundary-links="true" total-items="total_items" items-per-page="items_per_page" ng-model="current_page" ng-change="set_page();" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></pagination>
                </div>
            </div>
        </div>
        <div class="col-xs-12 col-sm-12 col-md-6" id="user_profile">
            <div class="row">
                <h3>{{current_user.first_name}} {{current_user.last_name}} <small>{{current_user.dogs[0].name}}</small></h3>
                <p>{{current_user.email}}</p>
                <div id="profile_pics">
                    <div class="col-xs-6"><img preload-image src="{{current_user.avatar_url }}" alt=""></div>
                    <div class="col-xs-6"><img preload-image src="{{current_user.dogs[0].avatar_url }}" alt=""></div>
                </div>
            </div>
            <div class="row" id="conversations">
                <h3 id="messages_header">Messages</h3>
                <accordion close-others="oneAtATime" id="messages_wrapper">
                    <accordion-group ng-repeat="conversation in conversations track by $index">
                        <accordion-heading>
                            <div class="convo_header">
                                <img preload-image ng-src="{{ conversation.recipient.avatar_url }}" />
                                <h5 class="name">{{ conversation.recipient.first_name }} {{ conversation.recipient.last_name }}</h5>
                            </div>
                        </accordion-heading>
                        <div class="messages">
                            <div class="row">
                                <ul class="list-group">
                                    <li class="list-group-item" ng-repeat="message in conversation.messages" ng-class="{ 'message-remote': message.user_id != current_user.id, 'message-local': message.user_id == current_user.id }">
                                        <p>{{ message.body }}</p>
                                        <span class="date">{{ message.created_at | date: 'short' }}</span>
                                    </li>
                                </ul>
                            </div>
                            <div class="row">
                                <div class="input-group">
                                    <input type="text" class="form-control" ng-model="new_message.body">
                                    <span class="input-group-btn"><input class="btn btn-primary" type="submit" ng-click="send_message(conversation.sender_id, conversation.recipient_id, new_message.body);" ng-enter="send_message(conversation.sender_id, conversation.recipient_id, new_message.body);" value="Send"></span>
                                </div>
                            </div>
                        </div>
                    </accordion-group>
                </accordion>
            </div>
        </div>
        <!-- div.col-xs-6.profile -->
    </div>
    <!-- div#profile_row -->
</div>
<!-- div.container -->